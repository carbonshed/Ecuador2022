---
title: "Pond Paper Figures"
author: "Kriddie"
date: "2024-04-15"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

#load library

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(lubridate)
library(dplyr)
library(ggplot2)
library(reshape2)
library("ggpubr")
library(rstatix)
library(devtools)
library(PMCMRplus)
library(lme4)
library(lmerTest)
library(jtools)
library(extraoperators)
library(JWileymisc)
library(multilevelTools)
library(broom)
#library(tidyverse)
library(tidyr)
library(stringr)
library(scales)
library(ggbreak)
library(viridis)
library(cowplot)
library(zoo)
library(grid)
library(gridExtra) 
library(emmeans)
library(multcomp)
library(performance) #evaluates mixed model
```

#About:
This Rmarkdown contains all code needed to produce the figures published in "Water Temperature and Catchment Characteristics Drive Variance in Greenhouse Gas Emissions from Small Ponds in a Peatland-Rich, High-Altitude Tropical Ecosystem"

site descriptors includ: \> ave SA \> ave depth \> ave vol \>
cathment size \> elevation \> percent change in SA \> percent change in
vol \> percent veg \> DOC/TDN

*notes about statistics Check normality of residuals* Shapiro-Wilk Test:
if value is greater than 0.05, the data is normal. If it is below 0.05,
the data significantly deviate from a normal distribution Bartlett's
test tests the hypothesis that our samples have equal variances. If the
Chi- Square test is significant (p \< . 05), then we can reject the null
hypothesis and assume that variances are unequal.

#summary table

```{r table 1}
WL_df <- read.csv(here::here("Wetlands/WaterLevel_FINAL/WL_Wetland_all_FINAL.csv"))
WL_df[WL_df$Station=="WL_Wetland12",]$depth_ave_m <- WL_df[WL_df$Station=="WL_Wetland12",]$WaterLevel_m

WL_df <- WL_df%>%select(DateTime,Station,WLTemp_c,depth_ave_m,surface_area_m2,Volumn_m3)%>%
  rename(Site=Station)%>%rename(WaterTemp_c=WLTemp_c)
WL_df$Site <- gsub(".*_","",WL_df$Site)
WL_df$WaterTemp_c <- ifelse(WL_df$WaterTemp_c < 0, 0, WL_df$WaterTemp_c)
WL_df$depth_ave_cm <- WL_df$depth_ave_m *100

WL_df_sum <- WL_df%>%group_by(Site)%>%
  dplyr::summarise(
    SA_m2_mean = mean(surface_area_m2,na.rm=TRUE),
    SA_sd = sd(surface_area_m2,na.rm=TRUE),
    depth_cm_mean = mean(depth_ave_cm,na.rm=TRUE),
    depth_sd = sd(depth_ave_cm,na.rm=TRUE),
    vol_m3_mean = mean(Volumn_m3,na.rm=TRUE),
    vol_sd = sd(Volumn_m3,na.rm=TRUE)
  )

sum_table <- read.csv(here::here("ProcessedData/PondPaper_k600_May29.csv"))%>%select(Site,New.Name,Elevation_m,WS_area_minus_pond,DOC_mg.L,TDN_mg.L)
sum_table <- sum_table%>%group_by(Site,New.Name)%>%
  dplyr::summarise(
    Elevation_m = mean(Elevation_m,na.rm=TRUE),
    Catchment_size = max(WS_area_minus_pond,na.rm=TRUE),
    DOC_mg.L = min(DOC_mg.L,na.rm=TRUE),
    TDN_mg.L = mean(TDN_mg.L,na.rm=TRUE)
  )


table1 <- full_join(sum_table,WL_df_sum,by="Site")
table1$Site <- NULL

#write.csv(table1,"~/OneDrive - University of North Carolina at Chapel Hill/Dissertation papers/Wetland GHG/Tables/table1_june5.csv")
```

#med-deli plot 
this graph shows the hydrology of the system

```{r med deli plot,echo=FALSE}

#I want to make a 12 panel figure with 2 axis depth and surface area

WL_df <- read.csv(here::here("Wetlands/WaterLevel_FINAL/WL_Wetland_all_FINAL.csv"))
#we don't have depth for wetland 12 but we can use water level to plot
WL_df[WL_df$Station=="WL_Wetland12",]$depth_ave_m <- WL_df[WL_df$Station=="WL_Wetland12",]$WaterLevel_m
WL_df <- WL_df[c("DateTime","Station","Baro_kpa","BaroTemp_c","WLTemp_c","depth_ave_m","surface_area_m2","Volumn_m3","SA_to_Vol_ratio")]
WL_df$DateTime <- as.POSIXct(WL_df$DateTime,format="%Y-%m-%d %H:%M:%S",tz="UTC")
WL_df$Station <- str_sub(WL_df$Station,4)

#read in elevation data to merge with WL
df <- read.csv(here::here("ProcessedData/PondPaper_k600_May29.csv"))%>%select(Site,New.Name,Elevation_m)
df <- unique(df)

#med deli plot

Summary_df <- WL_df%>%
 group_by(Station)%>%
  summarise(
    SA_max = max(surface_area_m2, na.rm = TRUE),
    SA_min = min(surface_area_m2, na.rm = TRUE),
    SA_mean = mean(surface_area_m2, na.rm = TRUE),
    depth_max = max(depth_ave_m, na.rm = TRUE),
    depth_min = min(depth_ave_m, na.rm = TRUE),
    depth_mean = mean(depth_ave_m, na.rm = TRUE)
  )%>%rename(Site=Station)

Summary_df <- full_join(Summary_df,df,by="Site")

p2 <- ggplot(data=Summary_df,aes(x=SA_mean,y=depth_mean, fill=Elevation_m)) +
  geom_point(shape=22,size=5) +
  geom_segment(aes(x = SA_min, y = depth_mean, xend = SA_max, yend = depth_mean), color="grey25",linewidth=.5) +
  geom_segment(aes(x = SA_mean, y = depth_min, xend = SA_mean, yend = depth_max), color="grey25",linewidth=.5) +
  scale_y_log10() + scale_x_log10() +
  theme_classic() +
  theme(text=element_text(size=20)) + guides(fill=guide_legend(title="Elevation (m)")) +
  theme(
    axis.text.x = element_text(color="black"),
    axis.ticks = element_line(color = "black")) +
  xlab(expression('Surface Area ('~m^2~')')) + ylab("Depth (m)") +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.text.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0))
)

p3 <- p2 + annotation_logticks(
  base = 10,
  sides = "bl",
  outside = TRUE,
  scaled = TRUE,
  short = unit(0.1, "cm"),
  mid = unit(0.2, "cm"),
  long = unit(0.3, "cm"),
  colour = "black",
  linewidth = 0.5,
  linetype = 1,
  alpha = 1,
  color = "grey40"
) + coord_cartesian(clip = "off")

```

#water temp v elevation 
at all sites R squared over time, maybe RME over
time?

```{r water temp plot}
precip_df <- read.csv(here::here("WeatherStation_LaVirgen/M5025_Precipitacion_Dato_validado.csv"))
colnames(precip_df) <- c("DateTime","precipt_mm")
precip_df$DateTime <- as.POSIXct(precip_df$DateTime,format="%Y-%m-%d %H:%M:%S",tz="UTC")
precip_df$Date <- as.Date(precip_df$DateTime,format="%Y-%m-%d")
precip_summary <- precip_df%>%
  filter(DateTime>as.POSIXct("2022-06-16 11:00:00",tz="UTC") & DateTime < as.POSIXct("2023-08-24 13:15:00",tz="UTC"))%>%
  group_by(Date)%>%
  summarise(PrecipAccuDay_mm = sum(precipt_mm))
#I would like to do a 7 day average 
precip_weekAve <- transform(precip_summary, avg7 = rollmeanr(PrecipAccuDay_mm, 7, fill = NA,na.rm=TRUE))
colnames(precip_weekAve) <- c("Date","PrecipAccuDay_mm","Precip_mm_ave7")

WL_df <- read.csv(here::here("Wetlands/WaterLevel_FINAL/WL_Wetland_all_FINAL.csv"))%>%select("DateTime","Station","WLTemp_c","BaroTemp_c")%>%rename(Site=Station,AirTemp=BaroTemp_c)
WL_df$DateTime <- as.POSIXct(WL_df$DateTime,format="%Y-%m-%d %H:%M:%S",tz="UTC")
WL_df$Site <- str_sub(WL_df$Site,4)


df1 <- read.csv(here::here("ProcessedData/PondPaper_k600_May29.csv"))

gmc <- df1 %>%
  group_by(New.Name,Site,Elevation_m) %>%
  mutate(gpm_Watertemp_c = mean(Watertemp_c)) %>% 
  ungroup()
df <- df1%>%select(Site,Elevation_m,Watertemp_c)
df <- unique(df)

WL_df <- left_join(WL_df,df,by="Site")


start_time <- as.POSIXct("2022-06-16 11:00:00",tz="UTC")
end_time <- as.POSIXct("2023-08-24 13:15:00",tz="UTC")
timestamp_sequence <- seq.POSIXt(start_time, end_time, by = "hour")

new_df <- as.data.frame(timestamp_sequence)
new_df <- new_df%>%rename(DateTime=timestamp_sequence)

#new_df <- WL_df%>%select(DateTime)
new_df$slope <- NA
new_df$adjR <- NA
new_df$n <- NA
new_df$AirTemp_c <- NA
new_df$RMSE <- NA
new_df$pvalue <- NA
new_df$slope <- NA
i <-2
for (i in 1:nrow(new_df)) {
  select_timestamp <- new_df[i,]$DateTime
  #filter 
  filter_df <-  WL_df%>%filter(DateTime==select_timestamp)
  new_df[i,]$AirTemp_c <- mean(filter_df$AirTemp)
  if(nrow(filter_df) > 5){
    model <- lm(WLTemp_c ~ Elevation_m, data = filter_df)
    new_df[i,]$slope <- summary(model)$coefficients[2,1]
    new_df[i,]$adjR <- summary(model)$adj.r.squared
    new_df[i,]$RMSE <- sqrt(mean(model$residuals^2))
    new_df[i,]$pvalue <- summary(model)$coefficients[2,4]
    new_df[i,]$n <- nrow(filter_df)
    new_df[i,]$slope <- as.numeric(model$coefficients[2])
    
  }else{
    new_df[i,]$adjR <- NA
  }
    
} 



adjR.plot2 <- ggplot()+ geom_line(data=new_df%>%filter(n>7),aes(x=DateTime,y=adjR),color="salmon") +
  ylab(expression(paste("\nAdj. r squared"))) +
   theme_classic(base_size = 14)+
  xlim(as.POSIXct("2022-07-01 12:00:00"),as.POSIXct("2023-07-01 00:00:00"))+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) 

slope.plot <- ggplot()+ 
  geom_point(data=new_df%>%filter(DateTime>as.POSIXct("2022-07-01 12:00:00")&DateTime<as.POSIXct("2023-07-01 00:00:00"))%>%filter(slope<0),aes(x=DateTime,y=slope),color="black",shape=1)  +
  geom_point(data=new_df%>%filter(DateTime>as.POSIXct("2022-07-01 12:00:00")&DateTime<as.POSIXct("2023-07-01 00:00:00"))%>%filter(slope>0),aes(x=DateTime,y=slope),color="grey",shape=1) + ylab("Slope of\n linear regression") +
   theme_classic(base_size = 14)+
  xlim(as.POSIXct("2022-07-01 12:00:00"),as.POSIXct("2023-07-01 00:00:00"))


precip.plot <- ggplot(aes(x=Date, y=Precip_mm_ave7), data = precip_weekAve) + geom_point(color="steelblue")+ geom_line(color="steelblue")+
 ylab("Precipitation\n7 day ave. (mm)") +
    xlim(as.Date("2022-07-02"),as.Date("2023-07-01")) +
  theme_classic(base_size = 14)+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) 


p1 <- ggplot() + geom_point(data=df1,aes(x=Elevation_m,y=Watertemp_c,fill = reorder(New.Name,Elevation_m,median,decreasing = TRUE)),shape=21,size=2)+
  geom_point(data=gmc,aes(x=Elevation_m,y=gpm_Watertemp_c),fill="black",shape=23,size=3)+
  guides(fill=guide_legend(title="Site name",ncol=2))+ 
  xlab("Elevation (m)") + ylab("Water temp. (C)") +
  geom_smooth(data=gmc,aes(x=Elevation_m,y=gpm_Watertemp_c),method='lm',formula = "y ~ x",se=TRUE,color="black") +
  theme_bw(base_size = 14)

#zoom in 
d = data.frame(x = seq(from = as.POSIXct("2022-07-01 12:00:00"), to=as.POSIXct("2022-08-01 00:00:00"), by = "1 hour"), y = 1)
d$hour = as.numeric(format(d$x, "%H"))
d$hour_shade =ifelse(d$hour >= 18 | d$hour <= 6, "gray80", "gray95")


zoom.plot <- ggplot(d, aes(x, y)) + 
  geom_rect(aes(xmin = x, xmax = lead(x), ymin = -Inf, ymax = Inf,
                fill = hour_shade)) +
  scale_fill_identity() +
  geom_line(data=new_df,aes(x=DateTime,y=adjR),color="salmon",linewidth=1) +
  ylab(expression(paste("Adj. r squared"))) + xlab("")  +
   theme_classic(base_size = 14)+
  xlim(as.POSIXct("2022-07-01 12:00:00"),as.POSIXct("2022-08-01 00:00:00"))

###plot all

plot_column1 <- cowplot::plot_grid(NULL,
  precip.plot+ rremove("x.axis") + rremove("xlab"), NULL,
  adjR.plot2+ rremove("x.axis") + rremove("xlab"), NULL,
  slope.plot, 
  ncol = 2, rel_widths = c(.02,1),
  labels = c("","A","","B","","C"),
  hjust = 1,
  label_size = 13,
  label_fontface = "bold",
  align = "v")

plot_column2 <- cowplot::plot_grid(
  p1, 
  zoom.plot,
  ncol = 2,
  labels = c("D","E"),
  label_size = 14,
  label_fontface = "bold")


# then combine with the top row for final plot
full_plot <- plot_grid(plot_column1,plot_column2,nrow=2,rel_heights = c(1.5,1))

```

# Variance within wetlands

For the review, I'd like to change the analysis from looking at center
vs edge to between dates

*Shapiro-Wilk Test:*
Check normality of residuals. if value is greater than 0.05, the data is normal. If it is below 0.05,
the data significantly deviate from a normal distribution \###
*Bartlett's test:*
tests the hypothesis that our samples have equal
variances. If the Chi- Square test is significant (p \< . 05), then we
can reject the null hypothesis and assume that variances are unequal.

##stats

```{r analysis 1}

df_CO2_full <- read.csv(here::here("ProcessedData/All_CO2_samples_June24.csv"))
df_CO2_full$Date <- as.Date(df_CO2_full$Date,format="%Y-%m-%d")

df_CH4_full <- read.csv(here::here("ProcessedData/CH4samples_allsamples_June24.csv"))
df_CH4_full$Date <- as.Date(df_CH4_full$Date,format="%Y-%m-%d")

site <- "Wetland"
# Check normality of residuals
result <- aov(log(pCO2_w_uatm) ~ as.factor(Date) , data = df_CO2_full#%>%filter(Date<"2022-10-01")
              %>%filter(New.Name==site))
summary(result)
res <- residuals(result)
qqnorm(res) 
qqline(res)
shapiro.test(res) #normality
bartlett.test(log(pCO2_w_uatm)  ~ Date, data = df_CO2_full%>%filter(Date<"2022-10-01") 
              %>%filter(New.Name==site))

summary(result)

#pCO2
#significantly diff by date
#S1, S2, S3, S4, S5, S8, S12
#not significantly diff by date
#S7, S12, S11, Wetland
#not enough measurments
#S6, S10

#tukey for S1, S2, S3, S4, S5, S8, S12
site <- "Wetland"
result <- aov(log(pCO2_w_uatm) ~ as.factor(Date) , data = df_CO2_full%>%filter(New.Name==site))
summary(result)
TukeyHSD(result, conf.level=.95)

#S1: 7/7/2022 is different from others
#S2: 7/7/2022 is different from others
#S3: all data statistically diff
#S4: 10/16 different from all, also 7/15 diff from 7/22
#S5: 2022-10-15 is different from all others
#S6: can't test
#S7: no diff
#S8: 7/19 diff from all others
#S10: can't diff
#S11: no diff
#S12: 7/08 diff from 10/16
#Wetland: no diff

#summary: 
#total ponds with testable summer data 10
#ponds with difference in summer data 5
#total ponds with fall data 6
#ponds with difference in fall 3

##CH4
site <- "S12"
# Check normality of residuals
result <- aov(log(pCH4_w_uatm) ~ as.factor(Date) , data = df_CH4_full#%>%filter(Date<"2022-10-01")
              %>%filter(New.Name==site)%>%filter(pCH4_w_uatm>0))
summary(result)
res <- residuals(result)
qqnorm(res) 
qqline(res)
shapiro.test(res) #normality
bartlett.test(log(pCH4_w_uatm)  ~ Date, data = df_CH4_full%>%
                filter(New.Name==site)%>%filter(pCH4_w_uatm>0)
              #%>%filter(Date<"2022-10-01") 
              )

summary(result)

#S4 and S12 does not meet normality assumptions

#pCH4
#significantly diff by date
#S12, S10, S8, S7, S6, S5, S4, S3, S2, S1
#not significantly diff by date
#S11, Wetland

#tukey for S10, S8, S6, S7, S5, S3, S2, S1
site <- "S7"
result <- aov(log(pCH4_w_uatm) ~ as.factor(Date) , data = df_CH4_full%>%filter(New.Name==site)%>%filter(pCH4_w_uatm>0)#%>%filter(Date<"2022-10-01")
              )
summary(result)
TukeyHSD(result, conf.level=.95)

#bonferroni for S4, S12 
site <- "S12"
## Dunn's all-pairs comparison test
results <- kwAllPairsConoverTest(log(pCH4_w_uatm) ~ as.factor(Date), data = df_CH4_full%>%filter(New.Name==site),
                             p.adjust.method = "bonferroni")
results

conver_results_CH4 <- conver_results_CH4$p.value
conver_results_CH4

#S1 07/14 and 7/25 same, 7/7/25 different
#S2 07/14 and 7/25 same, 7/7/25 different
#S3 all dates different
#S4 no difference
#S5 10/15 different from 7/11 and 7/19
#S6 10/15 different from 7/22 and 7/19
#S7 10/15 different from others
#S8 7/19 different from others
#S10 7/5 diff deom 7/8 and 7/18, but not 10/16
#S11 no difference
#S12 10/16 different from all others
#wetlands no difference

#summary: 
#total ponds with testable summer data 12
#ponds with difference in summer data 7
#total ponds with fall data 8
#ponds with difference in fall 4


```

##plot within site varianve

```{r plot variance, echo=FALSE}

#ch4 
df_CH4_full <- read.csv(here::here("ProcessedData/CH4samples_allsamples_June24.csv"))
df_CH4_full$Date <- as.Date(df_CH4_full$Date,format="%Y-%m-%d")
df_CH4_full$Date_2 <-format(df_CH4_full$Date, "%m-%d")

#co2
df_CO2_full <- read.csv(here::here("ProcessedData/All_CO2_samples_June24.csv"))%>%drop_na(Date)%>%drop_na(pCO2_w_uatm)
df_CO2_full$Date <- as.Date(df_CO2_full$Date,format="%Y-%m-%d")
df_CO2_full$Date_2 <-format(df_CO2_full$Date, "%m-%d")

sig_letters <- read.csv(here::here("Methane/signifacantLetters.csv"))
sig_letters$Date <- as.Date(sig_letters$Date,format="%m/%d/%y")

sig_letters_ch4 <- full_join(df_CH4_full%>%dplyr::select(New.Name,Date,Date_2,pCH4_w_uatm),sig_letters,by=c("New.Name","Date"))

sig_letters_co2 <- full_join(df_CO2_full%>%dplyr::select(New.Name,Date,Date_2,pCO2_w_uatm),sig_letters,by=c("New.Name","Date"))


sig_letters_co2 <- sig_letters_co2%>%
  group_by(New.Name)%>%
  mutate(
  max_co2 = max(pCO2_w_uatm),
  sd_co2 = sd(pCO2_w_uatm)
)

sig_letters_ch4 <- sig_letters_ch4%>%
  group_by(New.Name)%>%
  mutate(
  max_ch4 = max(pCH4_w_uatm),
  sd_ch4 = sd(pCH4_w_uatm)
)

df_CH4_full$New.Name <- factor(df_CH4_full$New.Name, levels = c("S1", "S2", "S3", "S4", "S5", "S6","S7","S8","Wetland","S10","S11","S12"))

df_CO2_full$New.Name <- factor(df_CO2_full$New.Name, levels = c("S1", "S2", "S3", "S4", "S5", "S6","S7","S8","Wetland","S10","S11","S12"))

sig_letters_ch4$New.Name <- factor(sig_letters_ch4$New.Name, levels = c("S1", "S2", "S3", "S4", "S5", "S6","S7","S8","Wetland","S10","S11","S12"))

sig_letters_co2$New.Name <- factor(sig_letters_co2$New.Name, levels = c("S1", "S2", "S3", "S4", "S5", "S6","S7","S8","Wetland","S10","S11","S12"))

CO2_air_max <- max(df_CO2_full$pCO2_air_uatm,na.rm = TRUE)
CO2_air_min <- min(df_CO2_full$pCO2_air_uatm,na.rm = TRUE)

CH4_air_max <- max(df_CH4_full$CH4_air_atm*10^6,na.rm = TRUE)
CH4_air_min <- min(df_CH4_full$CH4_air_atm*10^6,na.rm = TRUE)


p <- ggplot(df_CH4_full,aes(x=as.factor(Date_2),y=pCH4_w_uatm)) +
  geom_point() +
  facet_wrap(New.Name ~ ., scales = "free") +
  theme_bw(base_size = 10) +
  theme(axis.text.x=element_text(angle = -45, hjust = 0)) +
   ylab(expression(italic(p)*paste("CH"[4] ," (",mu,"atm)"))) +  xlab("")

p1 <- p + 
  geom_text(size=3,data = sig_letters_ch4, aes(x = as.factor(Date_2), y = max_ch4+sd_ch4, label = Letter_ch4)) + scale_y_continuous(expand = expansion(mult = c(0.1, 0.1))) 

#co2


p2 <- ggplot(df_CO2_full%>%drop_na(New.Name),aes(x=as.factor(Date_2),y=pCO2_w_uatm)) +
  geom_point() +
  facet_wrap(New.Name ~ ., scales = "free") +
  theme_bw(base_size = 10) +
  theme(axis.text.x=element_text(angle = -45, hjust = 0)) +
   ylab(expression(italic(p)*paste("CO"[2] ," (",mu,"atm)"))) +  xlab("")

p3 <- p2 + 
  geom_text(size=3,data = sig_letters_co2%>%drop_na(Date), aes(x = as.factor(Date_2), y = max_co2+sd_co2, label = Letter_co2)) + scale_y_continuous(expand = expansion(mult = c(0.1, 0.1))) 



```

# Between site variance

now we test for variance between sites

```{r site variance, echo=FALSE}
 
CH4_allsamples <- read.csv(here::here("ProcessedData/CH4samples_allsamples_June24.csv"))
CH4_allsamples$Date <- as.Date(CH4_allsamples$Date,format="%Y-%m-%d")

CH4_summary <- read.csv(here::here("ProcessedData/CH4samples_summary_June24.csv"))
CH4_summary$Date <- as.Date(CH4_summary$Date,format="%Y-%m-%d")

CO2_summary <- read.csv(here::here("ProcessedData/CO2_summary_June24.csv"))
CO2_summary$Date <- as.Date(CO2_summary$Date,format="%Y-%m-%d")

CO2_summary <- CO2_summary %>% mutate(pCO2_w_uatm_sd = ifelse(is.na(pCO2_w_uatm_sd), 0, pCO2_w_uatm_sd))

predictor_variables <- read.csv(here::here("ProcessedData/predictor_variables_June24.csv"))%>%dplyr::select(New.Name,Date, Elevation_m)
predictor_variables$Date <- as.Date(predictor_variables$Date,format="%Y-%m-%d")

predictor_variables <- unique(predictor_variables)

CH4_summary <- full_join(CH4_summary,predictor_variables,by=c("New.Name","Date"))

CO2_summary <- full_join(CO2_summary,predictor_variables,by=c("New.Name","Date"))

options(scipen = 100)
#methane
CH4_model <- aov(log1p(pCH4_w_uatm) ~ New.Name , data = CH4_summary)
summary(CH4_model)

# Check normality of residuals
res <- residuals(CH4_model)
qqnorm(res) 
qqline(res)
shapiro.test(res) #normality
bartlett.test(log(pCH4_w_uatm)  ~ New.Name, data = CH4_summary) 

#non-parametric
kruskal.test(log(pCH4_w_uatm) ~ New.Name , data = CH4_summary)
#this on is good
conver_results_CH4<- kwAllPairsConoverTest(log(pCH4_w_uatm) ~ as.factor(New.Name), data = CH4_summary, p.adjust="bonferroni")
conver_results_CH4 <- conver_results_CH4$p.value

CH4_model <- aov(log1p(pCH4_w_uatm) ~ New.Name , data = CH4_summary)

mod_means_contr <- emmeans::emmeans(object = CH4_model,
                                    pairwise ~ "New.Name",
                                    adjust = "bonferroni")

mod_means <- multcomp::cld(object = mod_means_contr$emmeans,
                           Letters = letters)
##co2

CO2_model <- aov(log(pCO2_w_uatm) ~ New.Name , data = CO2_summary)
summary(CO2_model)
# Check assumptions
res <- residuals(CO2_model)
qqnorm(res) 
qqline(res)
shapiro.test(res) #normality
bartlett.test(log(pCO2_w_uatm)  ~ New.Name, data = CO2_summary) 

conver_results_CO2<- kwAllPairsConoverTest(log(pCO2_w_uatm) ~ as.factor(New.Name), data = CO2_summary, p.adjust="bonferroni")
conver_results_CO2 <- conver_results_CO2$p.value

#co2 passes assumptions, but CH4 does not
tuk <- TukeyHSD(CO2_model)
tuk_df <- data.frame(tuk$New.Name)
tuk_df <- tuk_df%>%filter(p.adj<.05)


CO2_model <- aov(log1p(pCO2_w_uatm) ~ New.Name , data = CO2_summary)

mod_means_contr <- emmeans::emmeans(object = CO2_model,
                                    pairwise ~ "New.Name",
                                    adjust = "tukey")

mod_means <- multcomp::cld(object = mod_means_contr$emmeans,
                           Letters = letters)


#now you can do the figure
p.ch4 <- ggplot(CH4_summary,aes(x=reorder(New.Name,pCH4_w_uatm,mean,decreasing = FALSE),y=pCH4_w_uatm)) +
  geom_rect(aes(ymin=CH4_air_min, ymax=CH4_air_max, xmin=0, xmax=Inf),fill="red",alpha=.5) +
  stat_summary(geom = "point", fun = "mean", col = "red", size = 2, shape = 24, fill = "red") +
 geom_errorbar(aes(ymin = pCH4_w_uatm-pCH4_w_uatm_sd, ymax = pCH4_w_uatm+pCH4_w_uatm_sd), position = position_dodge2(width = 0.1), width = 0.3) +
  scale_y_log10() +
  ylab(expression(italic(p)*paste("CH"[4] ," (",mu,"atm)"))) +  xlab("") +
  theme_classic2(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  annotate("text", x = "S1", y = 15000, label = "A",size = 9/.pt) +
  annotate("text", x = "S2", y = 15000, label = "A",size = 9/.pt) +
  annotate("text", x = "S3", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "S4", y = 15000, label = "CD",size = 9/.pt) +
  annotate("text", x = "S5", y = 15000, label = "BCD",size = 9/.pt) +
  annotate("text", x = "S6", y = 15000, label = "ABC",size = 9/.pt) +
  annotate("text", x = "S7", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "S8", y = 15000, label = "CDE",size = 9/.pt) +
  annotate("text", x = "Wetland", y = 15000, label = "ABC",size = 9/.pt) +
  annotate("text", x = "S10", y = 15000, label = "E",size = 9/.pt) +
  annotate("text", x = "S11", y = 15000, label = "E",size = 9/.pt) +
  annotate("text", x = "S12", y = 15000, label = "DE",size = 9/.pt)


p.co2 <- ggplot(CO2_summary,aes(x=reorder(New.Name,pCO2_w_uatm,mean,decreasing = FALSE),y=pCO2_w_uatm)) +
    geom_rect(aes(ymin=CO2_air_min, ymax=CO2_air_max, xmin=0, xmax=Inf),fill="red",alpha=.5) +
  stat_summary(geom = "point", fun = "mean", col = "red", size = 2, shape = 24, fill = "red") +
 geom_errorbar(aes(ymin = pCO2_w_uatm-pCO2_w_uatm_sd, ymax = pCO2_w_uatm+pCO2_w_uatm_sd), position = position_dodge2(width = 0.1), width = 0.3) +
  scale_y_log10() +
  ylab(expression(italic(p)*paste("CO"[2] ," (",mu,"atm)"))) +  xlab("Site") +
theme_classic2(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  annotate("text", x = "S1", y = 15000, label = "AB",size = 9/.pt) + 
  annotate("text", x = "S2", y = 15000, label = "A",size = 9/.pt) +
  annotate("text", x = "S3", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "S4", y = 15000, label = "B",size = 9/.pt) +
  annotate("text", x = "S5", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "S6", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "S7", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "S8", y = 15000, label = "AB",size = 9/.pt) +
  annotate("text", x = "Wetland", y = 15000, label = "C",size = 9/.pt) +
  annotate("text", x = "S10", y = 15000, label = "DE",size = 9/.pt) +
  annotate("text", x = "S11", y = 15000, label = "CD",size = 9/.pt) +
  annotate("text", x = "S12", y = 15000, label = "E",size = 9/.pt)


###now do it ordering by elevation, not surface area


p.all <- ggarrange(p.ch4, p.co2, labels = c("(a)", "(b)"),heights=c(2,2), ncol = 1, nrow = 2)

```

# Drivers of pCO2 statistics


What other things might drive GHG concentrations? Here are our options:

1. Elevation
2. %DTW
3. Catchment size
4. surface area
5. volume
6. volume to surface area ratio
7. depth
8. air temp
9. water temp

##see CO2_models_revision
for details on models run
```{r site variance, echo=FALSE}

CO2_summary <- read.csv(here::here("ProcessedData/CO2_summary_June24.csv"))
CO2_summary$Date <- as.Date(CO2_summary$Date,format="%Y-%m-%d")

predictor_variables <- read.csv(here::here("ProcessedData/predictor_variables_July2.csv"))
predictor_variables$Date <- as.Date(predictor_variables$Date,format="%Y-%m-%d")

CO2_summary <- full_join(CO2_summary,predictor_variables,by=c("New.Name","Date"))

CO2_summary <- CO2_summary %>%
  group_by(New.Name,Elevation_m,percent_DTW, WS_area_minus_pond,waterTemp_c_yearly) %>%
  mutate(gpm_Watertemp_c = mean(Watertemp_c),
         gpm_WaterLevel_m = mean(WaterLevel_m),
         mean_pCO2_uatm = mean(pCO2_w_uatm),
         Watertemp_c_centered = Watertemp_c - gpm_Watertemp_c,
         WaterLevel_m_centered = WaterLevel_m -gpm_Watertemp_c) %>% 
  ungroup()


# get list of residuals
model <- lm(log(CO2_summary$pCO2_w_uatm)~CO2_summary$Elevation_m)
CO2_summary$res <- resid(model) 

xlab <- "Water temperature (°C)"
p.co2 <- ggplot() + 
  geom_smooth(data=CO2_summary,aes(x=gpm_Watertemp_c,y=mean_pCO2_uatm),method='lm',formula = "y ~ x",se=FALSE,color="black") +
  geom_point(data=CO2_summary,aes(x=Watertemp_c,y=pCO2_w_uatm,color=reorder(New.Name,Elevation_m,median,decreasing = TRUE)),size=2) +
  geom_point(data=CO2_summary,aes(x=Watertemp_c,y=pCO2_w_uatm),color="black",shape=1, size=2) +
  geom_point(data=CO2_summary,aes(x=gpm_Watertemp_c,y=mean_pCO2_uatm,fill=Elevation_m),shape=23,size=4)+
  geom_point(data=CO2_summary,aes(x=gpm_Watertemp_c,y=mean_pCO2_uatm),color="black",shape=3,size=1)+
  ylab(expression(italic(p)*paste("CO"[2] ," (",mu,"atm)"))) +
  xlab(xlab) +
  scale_color_viridis(name="Site",discrete = TRUE) +
  scale_y_continuous(transform="log",breaks=c(300,1000,3000,10000)) + 
  theme_bw(base_size = 14) +
  scale_fill_continuous(name = "Elevation (m)") +
  theme(legend.box = "horizontal") +
  guides(fill = guide_legend(order = 2),color = guide_legend(order = 1,ncol = 2)) + 
  guides(color = guide_legend(ncol = 2)) +
  annotate("text", label = paste0("atop('marg. '* R^2==0.43,RMSE==0.25)"),
           x = 5, y = 5000, size = 2.5, parse = TRUE)


p.co2.ele <- ggplot() +
    geom_smooth(data=CO2_summary,aes(x=Elevation_m,y=pCO2_w_uatm), method='lm',formula = "y ~ x",se=FALSE,color="black") +
  geom_point(data=CO2_summary,aes(x=Elevation_m,y=pCO2_w_uatm,color=reorder(New.Name,Elevation_m,median,decreasing = TRUE)),size=2) +
  geom_point(data=CO2_summary,aes(x=Elevation_m,y=pCO2_w_uatm),shape=1,size=2) +
  ylab(expression(italic(p)*paste("CO"[2] ," (",mu,"atm)"))) +
  xlab('Elevation (m)') +
  scale_color_viridis(name="Site",discrete = TRUE) +
  scale_y_continuous(transform="log",breaks=c(300,1000,3000,10000)) +
  theme_bw(base_size = 14) +
  annotate("text", label = paste0("atop('marg. '* R^2==0.74,RMSE==0.25)"),
           x = 4200, y = 5000, size = 2.5, parse = TRUE)


p.dtw.co2 <-  ggplot() + 
  geom_smooth(data=CO2_summary,aes(x=percent_DTW,y=res),method='lm',formula = "y ~ x",se=FALSE,color="black") +
  geom_point(data=CO2_summary,aes(x=percent_DTW,y=res,color=reorder(New.Name,Elevation_m,median,decreasing = TRUE)),size=2) +
  geom_point(data=CO2_summary,aes(x=percent_DTW,y=res),color="black",shape=1, size=2) +
  ylab('Residuals') + xlab('% DTW < 1-m') +
  scale_x_continuous(transform="log",breaks=c(1,3,10,30,100)) +
  scale_color_viridis(name="Site",discrete = TRUE) +
  theme_bw(base_size = 14)+ 
guides(color = guide_legend(ncol = 2)) +
  annotate("text", label = paste0("atop('marg. '* R^2==0.29,RMSE==0.26)"),
           x = 5, y = 1, size = 2.5, parse = TRUE)

###plots together
leg <- ggpubr::get_legend(p.co2)
leg_plot <- ggarrange(leg,nrow=1)

full_1 <- plot_grid(p.co2.ele  + rremove("legend") , p.co2+ rremove("legend"), p.dtw.co2+ rremove("legend"),leg_plot,ncol = 2, align = "v",labels=c("(a)","(b)","(c)"))

```

#Drivers of CH4
##see CH4_models_revision

```{r site variance, echo=FALSE}
#plot water temp as driver of CO2
CH4_summary <- read.csv(here::here("ProcessedData/CH4samples_summary_June24.csv"))
CH4_summary$Date <- as.Date(CH4_summary$Date,format="%Y-%m-%d")

predictor_variables <- read.csv(here::here("ProcessedData/predictor_variables_July2.csv"))#%>%select(New.Name,Date,Elevation_m)
predictor_variables$Date <- as.Date(predictor_variables$Date,format="%Y-%m-%d")

df <- left_join(CH4_summary%>%filter(pCH4_w_uatm>3),predictor_variables,by=c("New.Name","Date"))


# get list of residuals
model <- lm(log(df$pCH4_w_uatm)~df$Elevation_m)
df$res <- resid(model) 



gmc_ch4 <- df %>%
  dplyr::select(pCH4_w_uatm,pCH4_ppm,New.Name,Elevation_m,Watertemp_c)%>%
  group_by(Elevation_m) %>%
  mutate(mean_pCH4_uatm=mean(pCH4_w_uatm))%>%
  mutate( gpm_Watertemp_c = mean(Watertemp_c),
          Watertemp_c_centered = Watertemp_c - gpm_Watertemp_c)  %>% 
  ungroup()

#CH4 plots
xlab <- "Water temperature (°C)"
p.ch4 <- ggplot(gmc_ch4,aes(x=Watertemp_c,y=pCH4_w_uatm,color = reorder(New.Name,Elevation_m,median,decreasing = TRUE))) +
  geom_point(size=2)+
  geom_point(data=gmc_ch4,aes(x=Watertemp_c,y=pCH4_w_uatm,),shape=1,size=2,color="black")+
  geom_smooth(method='lm',formula = "y ~ x",se=FALSE) +
  geom_point(data=gmc_ch4,aes(x=gpm_Watertemp_c,y=mean_pCH4_uatm,fill=Elevation_m),color="black",shape=23,size=4)+
  geom_point(data=gmc_ch4,aes(x=gpm_Watertemp_c,mean_pCH4_uatm),shape=3,size=1,color="black") +
  guides(color=guide_legend(ncol=2)) +
  ylab(expression(italic(p)*paste("CH"[4] ," (",mu,"atm)"))) +
  xlab(xlab) +
  scale_color_viridis(name="Site",discrete = TRUE) +
  scale_y_continuous(transform="log",breaks=c(10,100,1000,10000)) +
  theme_bw(base_size = 14) +
  annotate("text", label = paste0("atop('marg. '* R^2==0.81,RMSE==0.43)"),
           x = 5, y = 3800, size = 2.5, parse = TRUE)
  

p.ch4.ele <- ggplot() +
    geom_smooth(data=gmc_ch4,aes(x=Elevation_m,y=pCH4_w_uatm), method='lm',formula = "y ~ x",se=FALSE,color="black") +
  geom_point(data=gmc_ch4,aes(x=Elevation_m,y=pCH4_w_uatm,color=reorder(New.Name,Elevation_m,median,decreasing = TRUE)),size=2) +
  geom_point(data=gmc_ch4,aes(x=Elevation_m,y=pCH4_w_uatm),shape=1,size=2) +
  ylab(expression(italic(p)*paste("CH"[4] ," (",mu,"atm)"))) +  xlab('Elevation (m)') +
  scale_color_viridis(name="Site",discrete = TRUE) +
  scale_y_continuous(transform="log",breaks=c(10,100,1000,10000)) +
  theme_bw(base_size = 14)+
  annotate("text", label = paste0("atop('marg. '* R^2==0.64,RMSE==0.67)"),
           x = 4040, y = 100, size = 2.5, parse = TRUE)


full_1 <- plot_grid(p.ch4 + 
  rremove("legend") ,p.ch4.ele+ 
  rremove("legend"),nrow=2,labels=c("(a)","(b)"))

leg <- ggpubr::get_legend(p.ch4)
full_4 <- ggarrange(leg,nrow=1)

full_5 <- ggarrange(full_1,full_4,widths = c(4,3), ncol = 2)

```





#DOC!

```{r GHG drviers, echo=FALSE}
df <- read.csv(here::here("ProcessedData/PondPaper_k600_May29.csv"))
#just the days when DOC was sample
df$Date <- as.Date(df$Date)
df1 <- df%>%filter(Date==as.Date("2022-07-27")|Date==as.Date("2022-07-25"))
df2 <- df%>%filter(Date==as.Date("2022-07-22"))%>%filter(Site!="Wetland12")
df3 <- df%>%filter(Date==as.Date("2022-07-19"))%>%filter(Site!="Wetland11")%>%filter(Site!="Wetland05")
df4 <- df%>%filter(Date==as.Date("2022-07-18"))
df_doc <- rbind(df1,df2,df3,df4)

M1 <- lm(log(pCO2_ppm) ~ 
             scale(DOC_mg.L),#+ 
        #    scale(Elevation_m), 
             data =df_doc)
summary(M1)

M1 <- lm(log(pCH4_ppm) ~ 
             scale(DOC_mg.L),#+ 
#            scale(Elevation_m), 
             data =df_doc)
summary(M1)
modelPerformance(M1)

M1 <- lm(log(Elevation_m) ~ 
             scale(DOC_mg.L),#+ 
        #    scale(Elevation_m), 
             data =df_doc)
summary(M1)

#why would co2 v DOC be negative??

```

#k and co2 as drivers of flux

```{r co2 v flux and co2 v k600, echo=FALSE}

k_df <- read.csv(here::here("ProcessedData/df_summary_June24.csv"))
k_df$Date <- as.Date(k_df$Date,format="%Y-%m-%d")

k_df_summer <- k_df%>%filter(Date<"2022-10-01")

 
M1.1 <- lmer(log(Flux_CO2_mol_m2_d) ~ 
            scale(log(pCO2_w_uatm))+
                    (1 |New.Name), data =k_df_summer %>%filter(K600_m_d>0))
summary(M1.1)
performance::model_performance(M1.1)

M1.2 <- lm(log(Flux_CO2_mol_m2_d) ~ 
            scale(log(pCO2_w_uatm)), data =k_df_summer %>%filter(K600_m_d>0))
summary(M1.2)

M2 <- lmer(log(Flux_CO2_mol_m2_d) ~ 
             scale(log(k_CO2_m_d)) +
                    (1 |New.Name), data =k_df_summer %>%filter(K600_m_d>0))
summary(M2)
performance::model_performance(M2)

performance::model_performance(M1)


CO2_air_max <- max(k_df_summer$pCO2_air_uatm,na.rm = TRUE)
CO2_air_min <- min(k_df_summer$pCO2_air_uatm,na.rm = TRUE)
CO2_air_ave <- mean(k_df_summer$pCO2_air_uatm,na.rm = TRUE)

k_df_summer$New.Name <- factor(k_df_summer$New.Name, levels=c("S1", "S2","S3","S4","S5","S6","S7","S8","Wetland","S10","S11","S12"))
 
p1 <- ggplot(k_df_summer%>%filter(K600_m_d>0) 
%>%drop_na(Flux_CO2_mol_m2_d),aes(x=pCO2_w_uatm,y=Flux_CO2_mol_m2_d)) + geom_point(aes(fill=New.Name),shape=21,size=3) +  
   geom_smooth(method='lm', color='black') + #guides(fill=guide_legend(title=expression(paste(italic('k')[600]," (m ", d^-1,")"))))+
  labs(fill="Site")+
  annotate("text", label = paste0("atop( R^2==0.78,RMSE==0.57)"),
           x = 3500, y = 0.001, size = 4, parse = TRUE) +
  geom_rect(aes(xmin=CO2_air_min, xmax=CO2_air_max, ymin=0, ymax=Inf),fill="red",alpha=.5) +
      ylab(expression(italic(p)~paste("CO"[2] ,"  Evasion (mol ", m^-2," ", d^-1,")"))) +
  xlab(expression(italic(p)*paste("CO"[2] ," (",mu,"atm)"))) +
  scale_x_continuous(transform = "log10") + scale_y_continuous(transform = "log10") +
  theme_bw(base_size = 14) 


```

# Modeling k or k600

surface area and solar radiation where both chosen for being significant
in lmer model. Solar radiation is the more significant variable, and if
removed, surface area is no longer selected

```{r co2 v flux and co2 v k600, echo=FALSE}


k_df <- read.csv(here::here("ProcessedData/df_summary_June24.csv"))
k_df$Date <- as.Date(k_df$Date,format="%Y-%m-%d")

k_df_summer <- k_df%>%filter(Date<"2022-10-01")
k_df_summer_positvevalues <- k_df%>%filter(Date<"2022-10-01")%>%filter(k_CO2_m_d>0)


predictor_variables <- read.csv(here::here("ProcessedData/predictor_variables_June24.csv"))#%>%select(New.Name,Date,Elevation_m)
predictor_variables$Date <- as.Date(predictor_variables$Date,format="%Y-%m-%d")

predictor_variables <- unique(predictor_variables)

k_df_summer_positvevalues <- left_join(k_df_summer_positvevalues,predictor_variables,by=c("New.Name","Date"))

median(k_df$K600_m_d,na.rm = TRUE)
mean(k_df$K600_m_d,na.rm = TRUE)

median(k_df_summer$K600_m_d)
mean(k_df_summer$K600_m_d)

median <- median(k_df_summer_positvevalues$K600_m_d)
mean <- mean(k_df_summer_positvevalues$K600_m_d)
diff <- (mean-median)/(mean+median)/2
ave <- (mean+median)/2

k_model <- aov(log(k_CO2_m_d) ~ New.Name , data = k_df_summer_positvevalues )
summary(k_model)

# Check normality of residuals
res <- residuals(k_model)
qqnorm(res) 
qqline(res)
shapiro.test(res) #normality
bartlett.test(log(k_CO2_m_d)  ~ New.Name, data = k_df_summer_positvevalues) 

## Dunn's all-pairs comparison test
results <- kwAllPairsConoverTest(log(k_CO2_m_d) ~ as.factor(New.Name), data = k_df_summer_positvevalues,
                             p.adjust.method = "bonferroni")
results

results <- results$p.value
results

k_df_summer_positvevalues$airtemp_diff <- k_df_summer_positvevalues$Watertemp_c - k_df_summer_positvevalues$AirTemp_c
M1 <- lmer(log(k_CO2_m_d) ~ 
        #     scale(log(pCO2_ppm)) +
        #  scale(log(surface_area_m2)) +
          scale(PrecipAccuDay_mm) +
         # airtemp_diff +
#          Watertemp_c +
  #        scale(windspeed_m_s) +
              #    scale(solarrad_W_m2) +
             (1|New.Name), data =k_df_summer_positvevalues )
summary(M1)
performance::model_performance(M1)

#failed predictors of k

p2.1 <- ggplot(k_df_summer_positvevalues%>%drop_na(K600_m_d)) + geom_point(
  aes(x=surface_area_m2,y=K600_m_d),fill="#31a354",
  shape=21,size=3)  + 
  geom_hline(aes(yintercept = median(K600_m_d)), color="blue", linetype="dashed") +
  theme_bw(base_size = 14) +
  scale_x_log10() + scale_y_log10() +
  xlab(expression(paste("Surface Area (",m^2, ")"))) +
    ylab(expression(paste(italic('k')[600]," (m ", d^-1,")"))) 

p2.2 <- ggplot(k_df_summer_positvevalues%>%drop_na(K600_m_d)) + geom_point(
  aes(x=windspeed_m_s,y=K600_m_d),fill="#31a354",
  shape=21,size=3)  + 
  geom_hline(aes(yintercept = median(K600_m_d)), color="blue", linetype="dashed") +
  theme_bw(base_size = 14) +
  scale_x_log10() + scale_y_log10() +
 xlab(expression(paste("Windspeed (m ",s^-1,")"))) + 
  ylab(expression(paste(italic('k')[600]," (m ", d^-1,")"))) 


p2.3 <- ggplot(k_df_summer_positvevalues %>%drop_na(K600_m_d)) + geom_point(
  aes(x=PrecipAccuDay_mm,y=K600_m_d),fill="#31a354",
  shape=21,size=3)  + 
  geom_hline(aes(yintercept = median(K600_m_d)), color="blue", linetype="dashed") +
  theme_bw(base_size = 14) +
  scale_x_log10() + scale_y_log10() +
 xlab(expression(paste("Precipitation Accumulation (mm)"))) + 
  ylab(expression(paste(italic('k')[600]," (m ", d^-1,")"))) 

p2.full <- ggarrange(p2.1,p2.2,p2.3,labels="AUTO",nrow=2,ncol=2)

```

#When is the wet season?
```{r wet season, echo=FALSE}


```

# Flux over time

now that we have our models of CO2 and CH4, lets try plotting them over
time

```{r co2 and ch4 flux over time, echo=FALSE}
modeled_GHG_df <- read.csv(here::here("ProcessedData/modeled_GHG_df.csv"))
modeled_GHG_df$DateTime <- as.POSIXct(modeled_GHG_df$DateTime,format="%Y-%m-%d %H:%M:%S",tz="UTC")
modeled_GHG_df <- modeled_GHG_df%>%filter(DateTime > "2022-07-06 00:00:00" & DateTime < "2023-07-06 00:00:00")
modeled_GHG_df$New.Name <- modeled_GHG_df$Site
#make column with new name to reflect elevation. S stands for "site"
modeled_GHG_df <- modeled_GHG_df%>%
  mutate(New.Name = case_match(New.Name, 'Wetland01' ~ 'S1', 'Wetland02' ~ 'S2','Wetland03' ~ 'S3','Wetland04' ~ 'S4','Wetland05' ~ 'S8', 'Wetland06' ~ 'S5', 'Wetland07' ~ 'S7', 'Wetland08' ~ 'S12', 'Wetland09' ~ 'S10', 'Wetland10' ~ 'S11', 'Wetland11' ~ 'S6','Wetland12' ~ 'wetland'))
modeled_GHG_df$New.Name <- factor(modeled_GHG_df$New.Name, levels = c("S1", "S2", "S3","S4","S5","S6","S7","S8","wetland","S10","S11","S12"))

seq_df <- seq(as.POSIXct("2022-07-06 00:00:00"), as.POSIXct("2023-07-06 00:00:00"), by="hour")
seq_df <- as.data.frame(seq_df)
colnames(seq_df) <- "DateTime"

modeled_GHG_df_2 <- left_join(seq_df,modeled_GHG_df,by=c("DateTime"))
modeled_GHG_df_2 <- modeled_GHG_df_2%>%
  drop_na(Site)%>%
  select(Site,New.Name, DateTime,WaterTemp_c,                                    flux_mol.sec.m2_co2_fixed,flux_mol.sec.m2_co2_fluctuate,flux_mol.sec.m2_ch4_fixed,flux_mol.sec.m2_ch4_fluctuate,
         F_mol.s_CH4,F_mol.s_CH4_fixedSA,F_mol.s_CH4_fixedTemp,F_mol.s_CH4_fixedTempfixedSA,F_mol.s_CO2,F_mol.s_CO2_fixedSA,F_mol.s_CH4_fixedTemp,F_mol.s_CO2_fixedTempfixedSA)


 melted_data <- modeled_GHG_df_2 %>%
    pivot_longer(
      cols = -c(Site,New.Name, DateTime,WaterTemp_c),  # Columns to be melted
      names_to = "Variable",      # Name of the new key column
      values_to = "Value"         # Name of the new value column
    )
melted_data$Model <- melted_data$Variable

melted_data$Model <- gsub("^[^_]*_[^_]*_", "", melted_data$Model)
melted_data$Model <- gsub("_.*", "", melted_data$Model)
  
modeled_GHG_df_2$month <- month(modeled_GHG_df_2$DateTime)
####

p.F.co2 <- ggplot(modeled_GHG_df_2) + 
  geom_line(aes(x=DateTime,y=flux_mol.sec.m2_co2_fluctuate*60*60*24),linetype="solid",color="#d95f02") + 
    geom_line(aes(x=DateTime,y=flux_mol.sec.m2_co2_fixed*60*60*24),linetype = "dashed", color="#1b9e77",linewidth=1) +
    facet_wrap(~New.Name, scales = "free") +
    ylab(CO[2]~evasion~(mol~m^-2~day^-1)) +
    scale_x_datetime(date_breaks = '4 month', date_labels=c('%b')) +
  scale_y_continuous(labels = scientific) +
  theme_bw(base_size = 14) 


#filter out extremes in S2 and S3
modeled_GHG_df_3 <- modeled_GHG_df_2%>%filter(New.Name!="S2")%>%filter(New.Name!="S3")

sub <-  modeled_GHG_df_2 %>%filter(New.Name=="S2"|New.Name=="S3")%>%filter(flux_mol.sec.m2_ch4_fluctuate<0.0003/60/60/24)

sub_test <-  modeled_GHG_df_2%>%filter(New.Name=="S2"|New.Name=="S3")%>%filter(flux_mol.sec.m2_ch4_fluctuate>0.0003/60/60/24)

modeled_GHG_df_3<-rbind(modeled_GHG_df_3,sub)

p.F.ch4 <- ggplot(modeled_GHG_df_3) + 
    geom_line(aes(x=DateTime,y=flux_mol.sec.m2_ch4_fluctuate*60*60*24),linetype="solid",color="#d95f02") + 
  geom_line(aes(x=DateTime,y=flux_mol.sec.m2_ch4_fixed*60*60*24),linetype = "dashed",color="#1b9e77",linewidth=1) +
  facet_wrap(~New.Name, scales = "free") +
  ylab(expression(CH[4]~evasion~(mol~m^-2~day^-1))) +
  scale_x_datetime(
    date_breaks = '4 month',
    date_labels=c('%b')) +
  scale_y_continuous(labels = scientific#,n.breaks=3
                     ) +
  theme_bw(base_size = 14) 

```

# High temp ch4 flux

this is script to figure our how to talk about ch4 flux at S2 and S3

```{r high temp flux, echo=FALSE}
test <- modeled_GHG_df%>%#filter(WaterTemp_c>15)%>%
filter(Site=="Wetland02")%>%drop_na(WaterTemp_c)
test <- modeled_GHG_df%>%filter(WaterTemp_c>15)%>%filter(Site=="Wetland04")%>%drop_na(WaterTemp_c)
#wetland 2
```

# flux over time per time

not sure I want to include this, but I do want to make the plots

```{r flux over time per , echo=FALSE}

p.F.co2 <- ggplot(modeled_GHG_df_2) + 
   geom_line(aes(x=DateTime,y=F_mol.s_CO2*60*60*24), color="black",linewidth=1) +
  geom_line(aes(x=DateTime,y=F_mol.s_CO2_fixedTemp*60*60*24),linetype="solid",color="#d95f02") + 
     geom_line(aes(x=DateTime,y=F_mol.s_CO2_fixedSA*60*60*24), color="blue",linewidth=1) +
    geom_line(aes(x=DateTime,y=F_mol.s_CO2_fixedTempfixedSA*60*60*24),linetype = "dashed", color="#1b9e77",linewidth=1) +
    facet_wrap(~New.Name, scales = "free") +
    ylab(CO[2]~evasion~(mol~day^-1)) +
    scale_x_datetime(
    date_breaks = '4 month',
    date_labels=c('%b')
    ) +
  theme_bw(base_size = 14) 


p.F.ch4 <- ggplot(modeled_GHG_df_3) + 
    geom_line(aes(x=DateTime,y=F_mol.s_CH4*60*60*24), color="black",linewidth=1) +
    geom_line(aes(x=DateTime,y=F_mol.s_CH4_fixedTemp*60*60*24),linetype="solid",color="#d95f02") + 
       geom_line(aes(x=DateTime,y=F_mol.s_CH4_fixedSA*60*60*24), color="blue",linewidth=1) +
  geom_line(aes(x=DateTime,y=F_mol.s_CH4_fixedTempfixedSA*60*60*24),linetype = "dashed",color="#1b9e77",linewidth=1) +
  facet_wrap(~New.Name, scales = "free") +
  ylab(expression(CH[4]~evasion~(mol~day^-1))) +
  scale_x_datetime(
    date_breaks = '4 month',
    date_labels=c('%b')) +
#  scale_y_continuous(labels = scientific) +
  theme_bw(base_size = 14) 
```

# Extrapolated flux bargraph

```{r sum flux, echo=FALSE}
modeled_GHG_sum_df <- modeled_GHG_df %>%
  select(Site,DateTime,
         F_mol.s_CH4,F_mol.s_CH4_fixedTemp,F_mol.s_CH4_fixedSA,F_mol.s_CH4_fixedTempfixedSA,
         F_mol.s_CO2,F_mol.s_CO2_fixedTemp,F_mol.s_CO2_fixedSA,F_mol.s_CO2_fixedTempfixedSA)
modeled_GHG_sum_df$month_Day <-  format(as.Date(modeled_GHG_sum_df$DateTime,format="%Y-%m-%d"), format = "%m-%d")
modeled_GHG_sum_df_2 <- modeled_GHG_sum_df%>%group_by(Site,month_Day)%>%
  summarise(
    F_CH4_mol.day = mean(F_mol.s_CH4,na.rm=TRUE),
    F_CH4_fixedTemp_mol.day = mean(F_mol.s_CH4_fixedTemp,na.rm=TRUE),
    F_CH4_fixedSA_mol.day = mean(F_mol.s_CH4_fixedSA,na.rm=TRUE),
    F_CH4_fixedTempfixedSA_mol.day = mean(F_mol.s_CH4_fixedTempfixedSA,na.rm=TRUE),
    F_CO2_mol.day = mean(F_mol.s_CO2,na.rm=TRUE),
    F_CO2_fixedTemp_mol.day = mean(F_mol.s_CO2_fixedTemp,na.rm=TRUE),
    F_CO2_fixedSA_mol.day = mean(F_mol.s_CO2_fixedSA,na.rm=TRUE),
    F_CO2_fixedTempfixedSA_mol.day = mean(F_mol.s_CO2_fixedTempfixedSA,na.rm=TRUE)
  )
modeled_GHG_sum_df_2$F_CH4_mol.day <- modeled_GHG_sum_df_2$F_CH4_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CH4_fixedTemp_mol.day <- modeled_GHG_sum_df_2$F_CH4_fixedTemp_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CH4_fixedSA_mol.day <- modeled_GHG_sum_df_2$F_CH4_fixedSA_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CH4_fixedTempfixedSA_mol.day <- modeled_GHG_sum_df_2$F_CH4_fixedTempfixedSA_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CO2_mol.day <- modeled_GHG_sum_df_2$F_CO2_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CO2_fixedTemp_mol.day <- modeled_GHG_sum_df_2$F_CO2_fixedTemp_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CO2_fixedSA_mol.day <- modeled_GHG_sum_df_2$F_CO2_fixedSA_mol.day*60*60*24
modeled_GHG_sum_df_2$F_CO2_fixedTempfixedSA_mol.day <- modeled_GHG_sum_df_2$F_CO2_fixedTempfixedSA_mol.day*60*60*24

modeled_GHG_sum_df_3 <- modeled_GHG_sum_df_2%>%group_by(Site)%>%
  summarise(
    F_CH4_mol.year = mean(F_CH4_mol.day,na.rm=TRUE),
    F_CH4_fixedTemp_mol.year = mean(F_CH4_fixedTemp_mol.day,na.rm=TRUE),
    F_CH4_fixedSA_mol.year = mean(F_CH4_fixedSA_mol.day,na.rm=TRUE),
    F_CH4_fixedTempfixedSA_mol.year = mean(F_CH4_fixedTempfixedSA_mol.day,na.rm=TRUE),
    F_CO2_mol.year = mean(F_CO2_mol.day,na.rm=TRUE),
    F_CO2_fixedTemp_mol.year = mean(F_CO2_fixedTemp_mol.day,na.rm=TRUE),
    F_CO2_fixedSA_mol.year = mean(F_CO2_fixedSA_mol.day,na.rm=TRUE),
    F_CO2_fixedTempfixedSA_mol.year = mean(F_CO2_fixedTempfixedSA_mol.day,na.rm=TRUE)
  )

modeled_GHG_sum_df_3$F_CH4_mol.year <- modeled_GHG_sum_df_3$F_CH4_mol.year * 365 
modeled_GHG_sum_df_3$F_CH4_fixedTemp_mol.year <- modeled_GHG_sum_df_3$F_CH4_fixedTemp_mol.year * 365
modeled_GHG_sum_df_3$F_CH4_fixedSA_mol.year <- modeled_GHG_sum_df_3$F_CH4_fixedSA_mol.year * 365
modeled_GHG_sum_df_3$F_CH4_fixedTempfixedSA_mol.year <- modeled_GHG_sum_df_3$F_CH4_fixedTempfixedSA_mol.year * 365
modeled_GHG_sum_df_3$F_CO2_mol.year <- modeled_GHG_sum_df_3$F_CO2_mol.year * 365
modeled_GHG_sum_df_3$F_CO2_fixedTemp_mol.year <- modeled_GHG_sum_df_3$F_CO2_fixedTemp_mol.year * 365
modeled_GHG_sum_df_3$F_CO2_fixedSA_mol.year <- modeled_GHG_sum_df_3$F_CO2_fixedSA_mol.year * 365
modeled_GHG_sum_df_3$F_CO2_fixedTempfixedSA_mol.year <- modeled_GHG_sum_df_3$F_CO2_fixedTempfixedSA_mol.year * 365

#convert to mol and then to gC-CO2
 melted_data_2 <- modeled_GHG_sum_df_3 %>%
    pivot_longer(
      cols = -c(Site),  # Columns to be melted
      names_to = "Model",      # Name of the new key column
      values_to = "mol.year"         # Name of the new value column
    )
 
 melted_data_2$New.Name <- melted_data_2$Site
#,ake column with new name to reflect elevation. S stands for "site"
melted_data_2 <- melted_data_2%>%
  mutate(New.Name = case_match(New.Name, 'Wetland01' ~ 'S1', 'Wetland02' ~ 'S2','Wetland03' ~ 'S3','Wetland04' ~ 'S4','Wetland05' ~ 'S8', 'Wetland06' ~ 'S5', 'Wetland07' ~ 'S7', 'Wetland08' ~ 'S12', 'Wetland09' ~ 'S10', 'Wetland10' ~ 'S11', 'Wetland11' ~ 'S6','Wetland12' ~ 'wetland'))
melted_data_2$New.Name <- factor(melted_data_2$New.Name, levels = c("S10","S6","S11","S12","S5","S4","S7","S8","S3","S2","wetland","S1"))

 
melted_data_2$Variable <- melted_data_2$Model

melted_data_3 <- melted_data_2%>%filter(Site!="Wetland12")
melted_data_2_sub <- melted_data_2%>%filter(Site=="Wetland12")%>%filter( Model=="F_CH4_fixedSA_mol.year"|Model=="F_CH4_fixedTempfixedSA_mol.year"|Model=="F_CO2_fixedSA_mol.year"|Model=="F_CO2_fixedTempfixedSA_mol.year")
melted_data_2_sub2 <- melted_data_2%>%filter(Site=="Wetland12")%>%filter( Model=="F_CO2_mol.year"|Model=="F_CO2_fixedTemp_mol.year"|Model=="F_CH4_mol.year"|Model=="F_CH4_fixedTemp_mol.year")
melted_data_2_sub2$mol.year <- 0

melted_data_3 <- rbind(melted_data_3,melted_data_2_sub,melted_data_2_sub2)


melted_data_co2 <- melted_data_3%>%filter(Variable=="F_CO2_mol.year"|Variable=="F_CO2_fixedTemp_mol.year"|Variable=="F_CO2_fixedSA_mol.year"|Variable=="F_CO2_fixedTempfixedSA_mol.year")
melted_data_ch4 <- melted_data_3%>%filter(Variable=="F_CH4_mol.year"|Variable=="F_CH4_fixedTemp_mol.year"|Variable=="F_CH4_fixedSA_mol.year"|Variable=="F_CH4_fixedTempfixedSA_mol.year")

melted_data_co2$gCasCO2.year <- melted_data_co2$mol.year*12
  
melted_data_ch4$gCasCH4.year <- melted_data_ch4$mol.year*12

#rearrang variable
melted_data_co2$Model <- factor(melted_data_co2$Model, levels = c("F_CO2_fixedTempfixedSA_mol.year","F_CO2_fixedSA_mol.year","F_CO2_fixedTemp_mol.year","F_CO2_mol.year"))

melted_data_ch4$Model <- factor(melted_data_ch4$Model, levels = c("F_CH4_fixedTempfixedSA_mol.year","F_CH4_fixedSA_mol.year","F_CH4_fixedTemp_mol.year","F_CH4_mol.year"))
#plot


p.ch4 <- ggplot(data=melted_data_ch4, aes(x=New.Name, y=gCasCH4.year, fill=Model)) +
geom_bar(stat="identity", color="black", position=position_dodge()) +
    theme_bw(base_size = 16) +
    ylab(expression("g of"~CH[4]~"as C"~~yr^-1)) +
  xlab("") +  theme(legend.position = "top")+
  scale_fill_manual(name="Model",labels=c("fixed surface area & temperature", "fixed surface area","fixed temperature","reference"), values=c("#ffffcc", "#a1dab4","#41b6c4","#225ea8"))

p.co2<- ggplot(melted_data_co2) + aes(x = New.Name, y = gCasCO2.year, fill=Model) +
  geom_bar(stat="identity", color="black", position=position_dodge())+
  ylab(expression("g of"~CO[2]~"as C"~~yr^-1)) +
  xlab("Site \n(ordered by increasing surface area)") +
  scale_y_cut(breaks=c(1.25*10^5), which=c(1, 2), scales=c(0.5, 3)) +
  theme_bw(base_size = 16) + theme(legend.position = "none")+
  scale_fill_manual(name="Model",labels=c("fixed surface area & temperature", "fixed surface area","fixed temperature","reference"), values=c("#ffffcc", "#a1dab4","#41b6c4","#225ea8"))

```

# calc % difference

```{r precent diff, echo=FALSE}
##calculate % difference 
co2_sum <- melted_data_co2%>%select(Model,Site,gCasCO2.year)%>%
  pivot_wider(names_from = c(Model), values_from = gCasCO2.year)
co2_sum$meanFixedTemp <- (co2_sum$F_CO2_fixedTemp_mol.year - co2_sum$F_CO2_mol.year)/(co2_sum$F_CO2_fixedTemp_mol.year + co2_sum$F_CO2_mol.year)/2 * 100
co2_sum$meanFixedSA <- (co2_sum$F_CO2_fixedSA_mol.year - co2_sum$F_CO2_mol.year)/(co2_sum$F_CO2_fixedSA_mol.year + co2_sum$F_CO2_mol.year)/2 * 100
co2_sum$meanFixedTempFixedSA <- (co2_sum$F_CO2_fixedTempfixedSA_mol.year - co2_sum$F_CO2_mol.year)/(co2_sum$F_CO2_fixedTempfixedSA_mol.year + co2_sum$F_CO2_mol.year)/2 * 100
#co2_sum_2 <- co2_sum%>%filter(Site!="Wetland01")

ch4_sum <- melted_data_ch4 %>%select(Model,Site,gCasCH4.year)%>%
  pivot_wider(names_from = c(Model), values_from = gCasCH4.year)

ch4_sum$meanFixedTemp <- (ch4_sum$F_CH4_fixedTemp_mol.year - ch4_sum$F_CH4_mol.year)/(ch4_sum$F_CH4_fixedTemp_mol.year + ch4_sum$F_CH4_mol.year)/2 * 100

ch4_sum$meanFixedSA <- (ch4_sum$F_CH4_fixedSA_mol.year - ch4_sum$F_CH4_mol.year)/(ch4_sum$F_CH4_fixedSA_mol.year + ch4_sum$F_CH4_mol.year)/2 * 100
ch4_sum$meanFixedTempFixedSA <- (ch4_sum$F_CH4_fixedTempfixedSA_mol.year - ch4_sum$F_CH4_mol.year)/(ch4_sum$F_CH4_fixedTempfixedSA_mol.year + ch4_sum$F_CH4_mol.year)/2 * 100

```

#holgerson and Raymond plot

```{r holgerson and raymond, echo=FALSE}

CO2_summary <- read.csv(here::here("ProcessedData/CO2_summary_June24.csv"))%>%dplyr::select(New.Name,Date,CO2_umol.L,Watertemp_c)
CO2_summary$Date <- as.Date(CO2_summary$Date,format="%Y-%m-%d")

CH4_summary <- read.csv(here::here("ProcessedData/CH4samples_summary_June24.csv"))%>%dplyr::select(New.Name,Date,CH4_umol.L)
CH4_summary$Date <- as.Date(CH4_summary$Date,format="%Y-%m-%d")

predictor_variables <- read.csv(here::here("ProcessedData/predictor_variables_July2.csv"))%>%dplyr::select(New.Name,Date,surface_area_m2)
predictor_variables$Date <- as.Date(predictor_variables$Date,format="%Y-%m-%d")

df_merge <- full_join(CO2_summary,CH4_summary,by=c("New.Name","Date"))
df_merge <- left_join(df_merge,predictor_variables,by=c("New.Name","Date"))


df_merge$Area_ha <-  df_merge$surface_area_m2 / 10000
df_merge$Reference <- "This Study"
df_merge$Location <- "La Virgen"
df_merge$latitude <- -0.324311
df_merge$longitude <- -78.1995
df_merge$Study.Years <- 2022
df_merge <- df_merge%>%dplyr::select(Reference,New.Name,Location,latitude,longitude,Study.Years,CH4_umol.L,CO2_umol.L,Area_ha,Watertemp_c)%>%rename(Site_Name=New.Name)

#read in Holgerston & Raymond data set
df_Holg <- read.csv(here::here("Wetlands/Holgerson&Raymond_data1.csv"))%>%rename("Site_Name"="Site.Name","CH4_umol.L"="ch4..umol.L.","CO2_umol.L"="co2..umol.L.","Area_ha"="area..ha.","Watertemp_c"="temp..C.")%>%dplyr::select(Reference,Site_Name,Location,latitude,longitude,Study.Years,CH4_umol.L,CO2_umol.L,Area_ha,Watertemp_c)

df_Holg <- rbind(df_Holg,df_merge)
df_Holg$CH4_umol.L <- as.numeric(df_Holg$CH4_umol.L)
df_Holg$CO2_umol.L <- as.numeric(df_Holg$CO2_umol.L)
df_Holg$Watertemp_c <- as.numeric(df_Holg$Watertemp_c)

df_Holg$New.Name <- df_Holg$Site_Name
df_Holg$New.Name <- factor(df_Holg$New.Name, levels = c("S1", "S2", "S3","S4","S5","S6","S7","S8","Wetland","S10","S11","S12"))

#summarize for discussion
df_Holg_test <- df_Holg%>%filter(Area_ha < .6)
df_Holg_test2 <- df_Holg%>%filter(Area_ha < .6)%>%filter(Reference != "This Study")
df_Holg_test_sum <- df_Holg_test%>%group_by(Reference)%>%
  summarise(
    max_CH4 = max(CH4_umol.L,na.rm=TRUE),
    min_CH4 = min(CH4_umol.L,na.rm=TRUE),
    ave_CH4 = mean(CH4_umol.L,na.rm=TRUE),
    std_CH4 = sd(CH4_umol.L,na.rm=TRUE),
    var_CH4 = var(CH4_umol.L,na.rm=TRUE),
    max_CO2 = max(CO2_umol.L,na.rm=TRUE),
    min_CO2 = min(CO2_umol.L,na.rm=TRUE),
    ave_CO2 = mean(CO2_umol.L,na.rm=TRUE),
    stdv_CO2 = sd(CO2_umol.L,na.rm=TRUE),
    var_CO2 = var(CO2_umol.L,na.rm=TRUE),
    n()
  
)

df_Holg_test2 <- df_Holg%>%filter(Area_ha < .6)%>%filter(Reference == "Bastviken et al. (2004)")


#log co2 v ch4
p <- ggplot() +
  geom_point(data=df_Holg,aes(x=CO2_umol.L,y=CH4_umol.L),color='grey80',size=3) +
  geom_point(data=df_Holg%>%filter(Area_ha < .6),
             aes(x=CO2_umol.L,y=CH4_umol.L),color="grey50",size=3) +
  geom_point(data=df_Holg%>%filter(Reference=="This Study"),
             aes(x=CO2_umol.L,y=CH4_umol.L,fill=New.Name),shape=21,size=3) +
    xlab(expression(paste("CO"[2] ," (",mu,"mol ", L^-1,")"))) +
    ylab(expression(paste("CH"[4] ," (",mu,"mol ", L^-1,")"))) +
  scale_y_log10() + scale_x_log10() + scale_fill_discrete(name = "Site") +
  theme_bw(base_size = 16) 

```

#summary \> most of our sites lower than in Hamilton et al. (1994) The

```         
studyarea was locatedin the high boreal and low subarcticwetlandregionof
the HudsonBay Lowland with the baseof operations at Moosonee, Ontario
TheHBL is comprised of approximately 85-90%wetlandareas[Pala and
Boissonneau,1982] and the entire area is underlain with impermeable
glacial moraineclays and silts
```

> our sites mostly lower in Kankaala et al. (2013) Kokema¨ enjoki
> drainage basin, southern Finland (Fig. 1). The lakes are rather
> shallow (maximum depth [z m ] 5–32 m, mean depth 2.4–10 m. Coniferous
> forests with Norway spruce (Picea abies) and Scots pine (Pinus
> sylvestris) cover 55–80% while peatlands cover , 20% of the catchment
> areas of the lakes

> our sites, all lower than Holgerson (2015)

```         
research forest in Tolland and Windham Counties, Connecticut, USA. The ponds are located in mixed deciduous-coniferous forest with minimal human disturbance. The soil types are Charlton-Chatfield Complex (Blacksmith, E8, Quarry, Woodpile Ponds) and Hinckley gravelly sandy loam
```

> Higher or within range of Laurion et al. (2010) subarctic
> discontinuous permafrost region, in the arctic continuous permafrost
> region. The subarctic thaw ponds are surrounded by dense shrubs
> (Betula glandulosa, Salix sp., Alnus sp., Myrica gale) and sparse
> trees (Picea mariana, Picea glauca, Larix laricina), with some areas
> colonized by Sphagnum spp. mosses. These thermokarst ponds are formed
> in depressions (1–3-m deep) left after the ice has melted below
> mineral mounds.

> Pelletier et al. (2014) where in the middle of our sites boreal
> peatland

> Shirokova et al. 2013 ocupied a ery similar range to our sites forest,
> forest-tundra, and tundra landscape that has been developed on
> discontinuous and sporadic permafrost; the discontinuous permafrost
> exists over Neocene sand and clay deposits, and is covered by a peat
> layer of 1–2 m. The ponds and lakes in this study originate from
> permafrost melt (soil subsidence)

> Bastviken et al. (2004)'s one sample is lower in methane

> ours sites similar range to 3 points in Delveccia et al 2019 (co2
> only)

> Mexican Cut Nature Preserve in the Elk Mountains of central Colorado,
> a pristine, subalpine wilderness area

# Wetland sampling

```{r gavi wetland, echo=FALSE}

df_CO2_full <- read.csv(here::here("ProcessedData/All_CO2_samples_June24.csv"))%>%filter(New.Name=="Wetland")%>%dplyr::select(pCO2_w_uatm)%>%rename(partialpressure=pCO2_w_uatm)
df_CO2_full$gas <- "pCO2"

df_CH4_full <- read.csv(here::here("ProcessedData/CH4samples_allsamples_June24.csv"))%>%filter(New.Name=="Wetland")%>%dplyr::select(pCH4_w_uatm)%>%rename(partialpressure=pCH4_w_uatm)
df_CH4_full$gas <- "pCH4"

df_center <- rbind(df_CO2_full,df_CH4_full)
df_center$Location <- "center"

drone_co2 <- read.csv(here::here("ProcessedData/Drone_Gavi_forImporttoArcPro_june30.csv"))%>%dplyr::select(pCO2_w_uatm)%>%rename(partialpressure=pCO2_w_uatm)
drone_co2$gas <- "pCO2"
drone_ch4 <- read.csv(here::here("ProcessedData/Drone_Gavi_forImporttoArcPro_june30.csv"))%>%dplyr::select(pCH4_w_uatm)%>%rename(partialpressure=pCH4_w_uatm)
drone_ch4$gas <- "pCH4"

df_margins <- rbind(drone_co2,drone_ch4)
df_margins$Location <- "margins"

df_all <- rbind(df_center,df_margins)

###
 

p2 <- ggplot(df_all,aes(x=gas, y=partialpressure,fill=Location)) +
  geom_boxplot(outlier.shape = NA) +
  geom_point(shape=21,color="black",position = position_jitterdodge(jitter.width = .25, jitter.height = 0, dodge.width = 0.75)) + ylab("") + xlab("") +
  scale_fill_grey(labels=c("open-water \ntransect","wetland \nmargins")) + 
    scale_x_discrete(labels=c("pCH4" = expression(italic(p)*paste("CH"[4] ," (",mu,"atm)")), "pCO2" = expression(italic(p)*paste("CO"[2]~" (",mu,"atm)" )))) +
  scale_y_continuous(transform = "log1p",breaks=c(1,10,100,1000,10000)) + theme_bw(base_size = 16) + theme(legend.position="top")

```

#supp fig: saturation relationship between pressure and gas saturation

```{r saturation fig, echo=FALSE}
 
p.A <- ggplot(df ,aes(x=Elevation_m,y=CO2_sat_precent)) + geom_point() +
  xlab("Elevation (m)") + 
      ylab(expression(paste("% sat CO"[2] ,))) +
  scale_y_continuous(transform="log",breaks=c(300,1000,3000,10000)) +
  theme_bw(base_size = 18) 

p.B <- ggplot(df ,aes(x=Elevation_m,y=pCO2_ppm)) + geom_point() +
  ylab(substitute(paste(italic('p'),CO[2], " (ppm)"))) +
  xlab(expression("Elevation (m)")) +
  scale_y_continuous(transform="log",breaks=c(300,1000,3000,10000)) +
  theme_bw(base_size = 18)


p.C <- ggplot(df ,aes(x=Elevation_m,y=CH4_pSat)) + geom_point() +
  xlab(expression("Elevation (m)")) +
        ylab(expression(paste("% sat CH"[4] ,))) +
  scale_y_continuous(transform="log",breaks=c(1000,10000,100000,1000000,10000000)) +
    theme_bw(base_size = 18)

p.D <- ggplot(df ,aes(x=Elevation_m,y=pCH4_ppm)) + geom_point() + 
    xlab(expression("Elevation (m)")) +
  ylab(substitute(paste(italic('p'),CH[4], " (ppm)"))) +
    scale_y_continuous(transform="log",breaks=c(1,10,100,1000,10000)) +
    theme_bw(base_size = 18)


full_plot1 <-plot_grid(p.A + theme(axis.title.x=element_blank()),
                      p.B + theme(axis.title.x=element_blank()),
                      p.C, 
                      p.D ,
                      labels = c("AUTO"),
                      label_size = 18,
                      label_fontface = "bold",
                      ncol = 2, nrow = 2, align = "v")


#% sat v concntration
p.E <- ggplot(df ,aes(x=pCH4_ppm,y=CH4_pSat)) + geom_point() +
    xlab(substitute(paste(italic('p'),CH[4], " (ppm)"))) +
          ylab(expression(paste("% sat CH"[4] ,))) +
      theme_bw(base_size = 18)


p.F <- ggplot(df ,aes(x=pCO2_ppm,y=CO2_sat_precent)) + geom_point() +
    xlab(substitute(paste(italic('p'),CO[2], " (ppm)"))) +
        ylab(expression(paste("% sat CO"[2] ,))) +
      theme_bw(base_size = 18)

full_plot2 <-plot_grid(p.F ,
                      p.E,
                      labels = c("AUTO"),
                      label_size = 18,
                      label_fontface = "bold",
                      ncol = 2)


```

```{r gavi wetland, echo=FALSE}

ggplot(df_merge) + geom_point(aes(x=log(DOC_mg.L),y=log(TDN_mg.L),color=Site_Name))

```
